<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game generator</title>
    <style>
        body {
            background-color: #202020;
            color: #ffffff;
        }

        span {
            cursor: pointer;
            color: #3498db;
        }
        #namesInput {
            background-color: #404040;
            color: #ffffff;
            padding: 8px;
            border: 1px solid #707070;
            margin-bottom: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<textarea id="namesInput" rows="4" cols="20" placeholder="Enter names, one per line"></textarea>
<button onclick="generate()">Generate</button>

<!-- Use a div to display the output on the page -->
<div id="output"></div>

<script>
    var pairs;
    var generated = false;

    function getRandomIndex(arr) {
        return Math.floor(Math.random() * arr.length);
    }

    function revealPair(killer, victim) {
        // Get the output div
        var outputDiv = document.getElementById('output');

        // Create a new paragraph element
        var paragraph = document.createElement('p');
    
        // Create a span for the killer's name (clickable)
        var killerSpan = document.createElement('span');
        killerSpan.innerText = killer + 'ðŸ”ª';
        killerSpan.style.cursor = 'pointer';
        killerSpan.onclick = function () {
            toggleVictim(victim);
        };

        // Create a span for the victim's name (initially hidden)
        var victimSpan = document.createElement('span');
        victimSpan.id = victim;
        victimSpan.innerText = victim;
        victimSpan.classList.add('hidden');

        paragraph.appendChild(killerSpan);
        paragraph.appendChild(victimSpan);

        outputDiv.appendChild(paragraph);

        // Scroll to the bottom of the div to show the latest reveal
        outputDiv.scrollTop = outputDiv.scrollHeight;
    }

    function toggleVictim(victim) {
        var victimSpan = document.getElementById(victim);
        // var currentDisplay = window.getComputedStyle(victimSpan).getPropertyValue('display');
        // victimSpan.style.display = (currentDisplay === 'none') ? 'inline' : 'none';
        victimSpan.classList.toggle('hidden');
    }

    function generate() {
        if (generated) {
            return
        }
        generated = true

        var namesInput = document.getElementById('namesInput');
        var names = namesInput.value.trim().split('\n');

        // Shuffle names array
        for (var i = names.length - 1; i > 0; i--) {
            var j = getRandomIndex(names);
            [names[i], names[j]] = [names[j], names[i]];
        }

        // Pair each person with the person next to them in the shuffled list
        pairs = names.map((value, index) => [value, names[(index + 1) % names.length]]);

        // Shuffle pairs array
        for (var i = pairs.length - 1; i > 0; i--) {
            var j = getRandomIndex(pairs);
            [pairs[i], pairs[j]] = [pairs[j], pairs[i]];
        }

        // Reveal all pairs
        for (var [killer, victim] of pairs) {
            revealPair(killer, victim);
        }
    }
</script>

</body>
</html>
